# Web vitals优化

> 优化用户体验质量是网络中所有网站要长期取得理想成效的关键。无论您是企业主、营销者还是开发者，网页指标都可以帮助您量化网站的用户体验，并发现提升的机会。

## 概览

**Web Vitals** 是 Google 提供的一组衡量用户体验的关键性能指标，旨在帮助开发者优化网站以提高用户满意度。Web Vitals 主要关注三个核心指标：**LCP**（Largest Contentful Paint）、**FID**（First Input Delay）和 **CLS**（Cumulative Layout Shift）。这三个指标直接影响到用户的感知性能和互动体验。

### 1. **Largest Contentful Paint (LCP)**

LCP 衡量的是页面加载过程中的最大可见元素的渲染时间，反映页面的加载速度和可见性。理想的 LCP 应该小于 **2.5 秒**，如果超过 4 秒，用户的体验会受到较大影响。

#### 优化方法：

- **优化服务器响应时间**：尽量减少服务器端的延迟，确保快速响应（例如，优化后端性能、使用缓存、CDN）。
- **减少资源阻塞**：确保关键资源（如 CSS、JavaScript）快速加载，避免加载阻塞。使用异步或延迟加载 JavaScript。
- **使用优化的图片格式**：图片是页面中最大的元素之一，使用 WebP、AVIF 等现代图片格式可以显著减少图片加载时间。
- **实现图片懒加载**：延迟加载页面中非重要图片，只有当它们进入视口时才加载。
- **使用服务工作者和缓存策略**：通过 Service Workers 和浏览器缓存，提高资源的加载速度，尤其在重复访问时。
- **优化字体加载**：确保自定义字体尽早加载，并考虑使用 `font-display: swap` 来避免字体加载时的空白。

### 2. **First Input Delay (FID)**

FID 衡量的是用户首次与页面交互（例如点击按钮或链接）时，浏览器响应该交互的延迟。理想的 FID 应该小于 **100 毫秒**，超过 300 毫秒可能会导致用户感到不流畅。

#### 优化方法：

- **减少主线程的工作负载**：避免将大量计算密集型的 JavaScript 代码阻塞主线程。可以通过代码分割和延迟加载来减少初始化时的 JavaScript 执行量。
- **优化 JavaScript 执行**：拆分大文件，使用 Web Workers 将耗时的计算移到后台线程，避免阻塞主线程。
- **优先执行重要的脚本**：使用 `async` 或 `defer` 属性来异步加载脚本，确保最重要的脚本优先加载。
- **减少第三方脚本的影响**：第三方 JavaScript（如广告、分析工具等）可能会增加页面负载和延迟，尽量减少不必要的第三方脚本。

### 3. **Cumulative Layout Shift (CLS)**

CLS 衡量页面在加载过程中内容的视觉稳定性。高 CLS 表示页面元素在加载过程中发生了显著的布局变化，影响了用户的体验。理想的 CLS 值应小于 **0.1**，如果 CLS 大于 0.25，用户会感到不稳定和混乱。

#### 优化方法：

- **为动态内容预留空间**：确保页面中的所有资源（如图片、广告、嵌入视频等）在加载之前已预留足够的空间。特别是对于图片和视频，应该指定明确的 `width` 和 `height` 属性。
- **避免无预见的字体调整**：使用 `font-display: swap`，避免字体在加载时导致的布局跳动。
- **为广告位指定明确的尺寸**：广告经常引起 CLS 问题，确保为广告容器定义固定的大小，并使用占位符。
- **避免非可预测的内容插入**：确保动态内容（如广告、推荐产品）在页面加载时不会破坏页面布局。避免页面上的广告位、动态弹出窗口等引发内容重新布局。

### 4. **其他相关的优化方法**

- **使用浏览器缓存**：合理使用缓存可以减少服务器请求次数，提升页面加载速度。
- **HTTP/2 和 HTTP/3**：启用 HTTP/2 或 HTTP/3 可以改善页面的加载性能，特别是在需要同时加载多个资源时。它们能够通过多路复用减少延迟，提升页面加载速度。
- **优化 CSS 和 JavaScript**：通过压缩和精简 CSS 和 JavaScript 文件，移除不必要的代码，减少页面加载的体积。
- **延迟加载资源**：对于不在视口中的资源（如图片、视频、iframe），可以使用懒加载技术，直到用户滚动到视口时才加载它们。
- **使用 Content Delivery Network (CDN)**：通过 CDN 将静态资源分发到离用户更近的地方，减少延迟，提升加载速度。
- **避免重定向**：每一次页面重定向都会增加额外的延迟，尽量避免多次重定向。

### 5. **工具和资源**

- **Google Lighthouse**：可以分析网页性能，包括 Web Vitals 指标，并提供优化建议。
- **Chrome DevTools**：通过 "Performance" 面板，您可以查看网页的加载和交互性能，查看具体的 Web Vitals 指标。
- **Web Vitals Extension**：Google 提供的 Chrome 插件，可以实时监测网页的 Web Vitals 性能。
- **Google PageSpeed Insights**：可以获取关于网页性能的详细报告，包括 Web Vitals 评分。
- **Core Web Vitals Report**：可以在 Google Search Console 中查看与 Core Web Vitals 相关的报告，帮助你理解哪些页面需要优化。

### 总结

Web Vitals 关注的是网站的用户体验，主要通过页面加载速度、互动响应时间和视觉稳定性来衡量。为了优化 Web Vitals，可以采取以下措施：

- 优化服务器响应时间，减少资源阻塞
- 使用现代格式的图片（如 WebP、AVIF）
- 减少主线程负担，优化 JavaScript
- 预留空间以避免布局跳动
- 使用缓存、CDN 和异步加载策略